- в течении 3х сек. нажать кнопку чтобы перейти в режим настройки. До прошествия 3х секунд мигает точка. В основном режиме точка погашена.
- при нажатии кнопки переходим в режим настроки. Точка горит постоянно.
- В режиме настройки загорается 1. Каждую секунду мигает. Мигание означает, что данные получены.
- Настройку начинаем с 1.
- Для подтверждения кратковременно нажать кнопку. При этом переходим к след передаче. 1-N-2-3-4-5-6
- Для завершения настроки нажать кнопку на 3 секунды.
- Завершить можно начиная с любой передачи. Если это повторная настройка, пропущенные передачи не изменятся.
- При выходе из режима настройки гаснет точка, на кнопку перестаёт отвечать.


byte gear = 1;
boolean pressed = FALSE;
byte pressedSeconds = 0;
byte v = 0;
while true {

    v = adcRead();
    
    if (digitalRead() == HIGH) {        //Кнопка нажата
        if (pressed == TRUE && _seconds - pressedSeconds > 2) { //  Долгое нажатие
            gears[gear] = v;
            writeEeprom(&gears);
            return;
        }
        if (pressed == FALSE) {
            pressed = TRUE;
            pressedSeconds = _seconds;
        }
    } else {                            //Кнопка отжата
        if (pressed == TRUE) {        
            if (gear == 0) gear = 2
            elif (gear == 1) gear = 0
            elif (gear == 6) gear = 1
            else gear++;
            pressed = FALSE;
            pressedSeconds = 0;
        }
        gears[gear] = v;
    }    
  
    if (_seconds - prevSeconds > 1) { 
        blink(gear,1);
        prevSeconds = _seconds;
    }
    indicate(gear,1);
    
}


В целом будет флаговый атомат.  Режим настройки описан выше. В основном режиме идёт непрерывное измерение и вывод данных. 
В основном режиме кнопка не опрашивается. Осноной режим определяется флагом nomalMode.
Режим настройки флагом setupMode
Кнопка опрашивается только при взведённом setupMode
После чтения данных из eeprom взводится оба флага и запускается таймер длительностью longPressTime
Если взведён setupNeeded, сразу переходим в режим настройки, таймер не запускается.
При переходе в режим настройки флаг normalMode сбрасывается, setupNeeded сбрасывается, таймер останавливается.
При выходе из режима настройки setupMode сбрасывается, normalMode взводится.



Для таймера 1 задаю максимальный преддлитель 1024. Он даёт 976,56 тиков в секунду. Мкасимальное время переполнения 67 секунд. 
Задаю прерывание по переполнению.
В регистр TCNT1 загружаю 65535-TICKS_1S*seconds
По прерыванию очищаю TCNT1, сбрасваю флаг, останавливаю таймер.


Основной режим - normalMode up
Режим настройки - setupMode up normalMode down
Первый longPressTime normalMode up setupMode up 

Таймер:
- при старте считает до longPressTime
- при переходе в настройки останавливается и запускается заново с интервалом 600мс
- при срабатывании таймера блинк
- при нажатии таймера блинк выключается, таймер считает до longPressTime пока нажата кнопка

Кнопка :
Button - свободный флаг
buttonPressed - флаг для подавления дребезга

Подавление дребезга:
кнопка отжата pin 0 buttonPressed 0 ret 0
Нажатие pin 1 buttonPressed 0; delay(40) buttonPressed=1 ret 1 
Кнопка нажата pin 1 buttonPressed 1, ret 1
Отпускание pin 0 buttonPressed 1, delay(40) ret 0   ret= pin|buttonPressed

